<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<th:block th:replace="~{/layout/basic :: setContent(~{this::content})}">
    <th:block th:fragment="content">

        <div id="main-content">
            <div class="page-heading">
                <div class="page-title">
                    <div class="row">
                        <div class="col-12 col-md-6 order-md-1 order-last">
                            <h3>House List</h3>
                            <p>본인이 원하는 매물을 <code class="highlighter-rouge">필터</code>를 이용하여 쉽게 찾아보세요.
                            </p>
                        </div>
                    </div>
                </div>

                <section id="content-types" class="section">
                    <div class="row">
                        <th:block th:each="dto : ${result.dtoList}">
                            <div class="col-xl-4 col-md-6 col-sm-12">


                                <div class="card">
                                    <div class="card-content">
                                        <div class="card-body">
                                            <h4 class="card-title">
                                                <div style="font-weight: bold">[[${dto.houseNum}]].</div>
                                                [[${dto.title}]]
                                            </h4>
                                            <h6 class="card-subtitle">[[${dto.address}]]</h6>
                                        </div>
                                        <div id="carouselExampleSlidesOnly" class="carousel slide"
                                             data-bs-ride="carousel">
                                            <div class="carousel-inner">
                                                <div th:each="houseImage : ${dto.imageDTOList}">
                                                    <a th:href="@{/house/read?(houseNum= ${dto.houseNum}, page=${result.page}, type=${pageRequestDTO.type}, keyword=${pageRequestDTO.keyword})}">
                                                        <img class="img-fluid w-100"
                                                             th:if="${houseImage.path != null}"
                                                             th:src="|/display?fileName=${houseImage.getThumbnailURL()}|">
                                                    </a>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="card-body">
                                            <ul class="nav nav-tabs" id="myTab" role="tablist">
                                                <li class="nav-item" role="presentation">
                                                    <a class="nav-link active" id="home-tab" data-bs-toggle="tab"
                                                       href="#home"
                                                       role="tab" aria-controls="home" aria-selected="true">Info</a>
                                                </li>
                                                <li class="nav-item" role="presentation">
                                                    <a class="nav-link" id="profile-tab" data-bs-toggle="tab"
                                                       href="#profile" role="tab" aria-controls="profile"
                                                       aria-selected="false">Option</a>
                                                </li>
                                                <li class="nav-item" role="presentation">
                                                    <a class="nav-link" id="contact-tab" data-bs-toggle="tab"
                                                       href="#contact" role="tab" aria-controls="contact"
                                                       aria-selected="false">Contact</a>
                                                </li>
                                            </ul>
                                            <div class="tab-content" id="myTabContent">
                                                <div class="tab-pane fade active show" id="home" role="tabpanel"
                                                     aria-labelledby="home-tab">
                                                    <br>
                                                    <table>
                                                        <thead>
                                                        <tr>Id</tr>
                                                        <tr>RegDate</tr>


                                                        </thead>
                                                        <tbody>
                                                        <td>
                                                            <p>[[${dto.id}]]</p>
                                                        </td>
                                                        <td><p>[[${#temporals.format(dto.regDate, 'yyyy/MM/dd')}]]</p>
                                                        </td>
                                                        </tbody>
                                                    </table>
                                                    <td>[[${dto.id}]]</td>
                                                    <td>ContractType</td>
                                                    <td>BuildingType</td>
                                                    <td>Area</td>
                                                    <td>RegDate</td>
                                                    <td>View</td>

                                                    <td>[[${dto.id}]]</td>
                                                    <td>[[${dto.contractType}]]</td>
                                                    <td>[[${dto.buildingType}]]</td>
                                                    <td>[[${dto.area}]]㎡</td>

                                                    <td>[[${dto.view}]]</td>
                                                    </p>
                                                </div>
                                                <div class="tab-pane fade" id="profile" role="tabpanel"
                                                     aria-labelledby="profile-tab">
                                                    Integer interdum diam eleifend metus lacinia, quis gravida eros
                                                    mollis.
                                                    Fusce non sapien
                                                    sit amet magna dapibus
                                                    ultrices. Morbi tincidunt magna ex, eget faucibus sapien bibendum
                                                    non. Duis
                                                    a mauris ex.
                                                    Ut finibus risus sed massa
                                                    mattis porta. Aliquam sagittis massa et purus efficitur ultricies.
                                                    Integer
                                                    pretium dolor
                                                    at sapien laoreet ultricies.
                                                    Fusce congue et lorem id convallis. Nulla volutpat tellus nec
                                                    molestie
                                                    finibus. In nec
                                                    odio tincidunt eros finibus
                                                    ullamcorper. Ut sodales, dui nec posuere finibus, nisl sem aliquam
                                                    metus, eu
                                                    accumsan
                                                    lacus felis at odio. Sed lacus
                                                    quam, convallis quis condimentum ut, accumsan congue massa.
                                                    Pellentesque et
                                                    quam vel
                                                    massa pretium ullamcorper vitae eu
                                                    tortor.
                                                </div>
                                                <div class="tab-pane fade" id="contact" role="tabpanel"
                                                     aria-labelledby="contact-tab">
                                                    <p class="mt-2">Duis ultrices purus non eros fermentum hendrerit.
                                                        Aenean
                                                        ornare interdum
                                                        viverra. Sed ut odio velit. Aenean eu diam
                                                        dictum nibh rhoncus mattis quis ac risus. Vivamus eu congue
                                                        ipsum.
                                                        Maecenas id
                                                        sollicitudin ex. Cras in ex vestibulum,
                                                        posuere orci at, sollicitudin purus. Morbi mollis elementum
                                                        enim, in
                                                        cursus sem
                                                        placerat ut.</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <p class="card-text">
                                            <div class="table-responsive">
                                                <table class="table mb-0">
                                                    <thead>
                                                    <tr>
                                                        <td>[[${dto.id}]]</td>
                                                        <td>ContractType</td>
                                                        <td>BuildingType</td>
                                                        <td>Area</td>
                                                        <td>RegDate</td>
                                                        <td>View</td>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    <tr>
                                                        <td>[[${dto.id}]]</td>
                                                        <td>[[${dto.contractType}]]</td>
                                                        <td>[[${dto.buildingType}]]</td>
                                                        <td>[[${dto.area}]]㎡</td>
                                                        <td>[[${#temporals.format(dto.regDate, 'yyyy/MM/dd')}]]</td>
                                                        <td>[[${dto.view}]]</td>
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            </p>


                                            [[${dto}]]
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </th:block>
                    </div>


                    <div class="card">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table mb-0">
                                    <thead class="thead-dark">
                                    <tr>
                                        <th>No</th>
                                        <th>제목</th>
                                        <th>작성자</th>
                                        <th>유형</th>
                                        <th>건물유형</th>
                                        <th>면적</th>
                                        <th>작성일</th>
                                        <th>조회</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="dto : ${result.dtoList}">
                                        <td>[[${dto.houseNum}]]</td>
                                        <td>
                                            <a th:href="@{/house/read?(houseNum= ${dto.houseNum}, page=${result.page}, type=${pageRequestDTO.type}, keyword=${pageRequestDTO.keyword})}">
                                                [[${dto.title}]]</a></td>
                                        <td>[[${dto.id}]]</td>
                                        <td>[[${dto.contractType}]]</td>
                                        <td>[[${dto.buildingType}]]</td>
                                        <td>[[${dto.area}]]㎡</td>
                                        <td>[[${#temporals.format(dto.regDate, 'yyyy/MM/dd')}]]</td>
                                        <td>[[${dto.view}]]</td>
                                    </tr>
                                    </tbody>
                                </table>


                                <div class="row" style="margin-right: -5;margin-left: 0px;margin-right: 0px;">
                                    <div class="col-md-3 mb-1">
                                        <div class="input-group mb-3">
                                            <form action="/house/list" method="get" id="searchForm">
                                                <input type="hidden" name="page" th:value="1">
                                        </div>
                                    </div>


                                    <div class="col-md-6 mb-1">
                                        <div class="input-group mb-3" style="margin-top: 2.5em">
                                            <select class="form-select" name="type">
                                                <option value="t" th:selected="${pageRequestDTO.type == 't'}">제목
                                                </option>
                                                <option value="c" th:selected="${pageRequestDTO.type == 'c'}">내용
                                                </option>
                                                <option value="w" th:selected="${pageRequestDTO.type == 'w'}">작성자
                                                </option>
                                                <option value="tc" th:selected="${pageRequestDTO.type == 'tc'}">제목 +
                                                    내용
                                                </option>
                                                <option value="tw" th:selected="${pageRequestDTO.type == 'tw'}">제목 +
                                                    작성자
                                                </option>
                                                <option value="cw" th:selected="${pageRequestDTO.type == 'cw'}">내용 +
                                                    작성자
                                                </option>
                                                <option value="tcw" th:selected="${pageRequestDTO.type == 'tcw'}">제목 +
                                                    내용 + 작성자
                                                </option>
                                            </select>
                                            <input type="text" name="keyword" class="form-control"
                                                   th:value="${pageRequestDTO.keyword}"
                                                   aria-label="Recipient's username" aria-describedby="button-addon2">
                                            <button class="btn btn-outline-secondary" type="button" id="clearBtn">
                                                Clear
                                            </button>
                                            <button class="btn btn-outline-secondary" type="button" id="searchBtn">
                                                Search
                                            </button>
                                        </div>
                                    </div>
                                    </form>
                                    <div class="col-md-3 mb-1 justify-content-end">
                                        <a th:href="@{/house/register}">
                                            <button type="button" class="btn btn-primary me-1 mb-1 rounded-pill"
                                                    style="margin-top: 2.5em; display: grid; grid-auto-flow: column; grid-template-columns: 1fr;">
                                                Register
                                            </button>
                                        </a>
                                    </div>
                                </div>


                                <nav aria-label="Page navigation example" style="margin-top: 2em">
                                    <ul class="pagination pagination-primary justify-content-center">
                                        <li class="page-item prev-page" th:if="${result.prev}">
                                            <a class="page-link"
                                               th:href="@{/house/list(page = ${result.start-1}, type = ${pageRequestDTO.type}, keyword = ${pageRequestDTO.keyword})}">
                                                <span aria-hidden="true"><i class="bi bi-chevron-left"></i></span></a>
                                        </li>
                                        <li th:class=" 'page-item '  + ${result.page == page ? 'active' : ''}"
                                            th:each="page: ${result.pageList}">
                                            <a class="page-link"
                                               th:href="@{/house/list(page = ${page}, type = ${pageRequestDTO.type}, keyword = ${pageRequestDTO.keyword})}">[[${page}]]</a>
                                        </li>
                                        <li class="page-item next-page" th:if="${result.next}">
                                            <a class="page-link"
                                               th:href="@{/house/list(page = ${result.end + 1}, type = ${pageRequestDTO.type}, keyword = ${pageRequestDTO.keyword})}">
                                                <span aria-hidden="true"><i class="bi bi-chevron-right"></i></span></a>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </th:block>
</th:block>


<script>

    $(document).ready(function () {
        var msg = '[[${msg}]]';

        if (msg) {
            console.log(msg);
            Swal.fire({
                icon: 'success',
                title: '[[${msg}]]',
                showConfirmButton: false,
                timer: 1500
            })
        }

        var searchForm = $("#searchForm");

        $("#searchBtn").click(function (e) {
            searchForm.submit();
        });

        $("#clearBtn").click(function (e) {
            $("input[name='keyword']").remove();
            $("select[name='type']").remove();
            $("input[name='page']").remove();
            searchForm.submit();
        });

    });
</script>